# Analytics API
frontend  contrail-analytics-api <%= scope.function_hiera(['public_vip']) %>:8081
    default_backend    contrail-analytics-api

backend contrail-analytics-api
    option nolinger
    balance     roundrobin
    default-server error-limit 1 on-error mark-down
<%- scope.lookupvar('contrail::baseos_ips').each_with_index do |ip, i| -%>
    server <%= ip %> <%= ip %>:9081 check inter 2000 rise 2 fall 3
<%- end -%>

# Contrail API
frontend  contrail-api <%= scope.function_hiera(['public_vip']) %>:8082
    default_backend    contrail-api-backend
    timeout client 3m

backend contrail-api-backend
    option nolinger
    timeout server 3m
    balance     roundrobin
<%- scope.lookupvar('contrail::baseos_ips').each_with_index do |ip, i| -%>
    server <%= ip %> <%= ip %>:9100 check inter 2000 rise 2 fall 3
<%- end -%>

# Contrail WebUI
frontend contrail-webui-api <%= scope.function_hiera(['public_vip']) %>:8143
    mode tcp
    default_backend contrail-webui-api

backend contrail-webui-api
    mode tcp
    balance roundrobin
    option nolinger
    stick on src
    stick-table type ip size 200k expire 30m
    option tcp-check
    tcp-check connect port 8143
    default-server error-limit 1 on-error mark-down
<%- scope.lookupvar('contrail::baseos_ips').each_with_index do |ip, i| -%>
    server <%= ip %> <%= ip %>:8143 check inter 2000 rise 2 fall 3
<%- end -%>
