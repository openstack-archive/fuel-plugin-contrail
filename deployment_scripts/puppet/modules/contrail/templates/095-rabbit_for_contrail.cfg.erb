listen rabbit
  bind <%= scope.lookupvar('contrail::contrail_private_vip') %>:5673
  mode tcp
  option tcplog
  balance roundrobin
  option redispatch
  timeout connect 5000
  timeout client 24h
  timeout server 24h
  option tcpka
  retries 3

<%- scope.lookupvar('contrail::rabbit_ips').each_with_index do |ip, i| -%>
    server <%= ip %> <%= ip %>:5673   check inter 10s fastinter 2s downinter 3s rise 3 fall 3
<%- end -%>
